<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.songone.www.enjoy.dao.mybatis.AlbumDao">
	<insert id="add" parameterType="Album" useGeneratedKeys="true" keyProperty="id">
		insert into tb_enjoycd_album
		(albumName,singerName,styleName,albumImg,albumIcon,singerImg,singerIcon,albumSongs,remark,state,createUser,createDate)
		values
		(#{albumName},#{singerName},#{styleName},#{albumImg},#{albumIcon},#{singerImg},#{singerIcon},#{albumSongs},#{remark},#{state},#{createUser},#{createDate})
	</insert>
	
	<update id="update" parameterType="Album">
		update tb_enjoycd_album album
		set album.albumName=#{albumName},
			album.singerName=#{singerName},
			album.styleName=#{styleName},
			album.albumImg=#{albumImg},
			album.albumIcon=#{albumIcon},
			album.singerImg=#{singerImg},
			album.singerIcon=#{singerIcon},
			album.albumSongs=#{albumSongs},
			album.remark=#{remark},
			album.state=#{state},
			album.createUser = #{createUser},
			album.createDate = #{createDate}
		where album.id = #{id}
	</update>
	
	<update id="checkAlbumSongState">
		update tb_enjoycd_album_songs song set song.state = selectAlbumsongUploadState(song.id) where song.state = 1;
	</update>
	
	<select id="queryModelByNameIndex" parameterType="Album" resultType="Album">
		select album.id,album.albumName,album.singerName,album.styleName,album.albumImg,album.albumIcon,album.singerImg,album.singerIcon,
			   album.albumSongs,album.remark,album.state,album.createUser,album.createDate
		from tb_enjoycd_album album
		where album.albumName = #{albumName} and album.singerName=#{singerName} and album.styleName=#{styleName}
	</select>
	
	<select id="getCanSyncAlbumSongs" parameterType="int" resultType="int">
		select count(song.id) from tb_enjoycd_album_songs song where song.state = 2 and song.parentId = #{albumId};
	</select>
	
	<select id="queryModelById" parameterType="int" resultType="Album">
		select album.id,album.albumName,album.singerName,album.styleName,album.albumImg,album.albumIcon,album.singerImg,album.singerIcon,
			   album.albumSongs,album.remark,album.state,album.createUser,album.createDate
		from tb_enjoycd_album album
		where album.id = #{id}
	</select>
	
	<select id="queryModelForCheckSync" parameterType="string" resultType="Album">
		select album.id,album.albumName,album.singerName,album.styleName,album.albumImg,album.albumIcon,album.singerImg,album.singerIcon,
			   album.albumSongs,album.remark,album.state,album.createUser,album.createDate
		from tb_enjoycd_album album
		<where>
			album.state= 1
			<if test="user != null">
			 and album.createUser = #{user},
			</if>
		</where>
		limit 0,100
	</select>
	
</mapper>